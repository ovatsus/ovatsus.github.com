<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: Windows Phone | Code Beside]]></title>
  <link href="http://blog.codebeside.org/blog/tags/windows-phone/atom.xml" rel="self"/>
  <link href="http://blog.codebeside.org/"/>
  <updated>2013-04-11T13:37:39+01:00</updated>
  <id>http://blog.codebeside.org/</id>
  <author>
    <name><![CDATA[Gustavo Guerra]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[F#, Windows Phone 7 & Visual Studio 2012]]></title>
    <link href="http://blog.codebeside.org/blog/2013/02/24/fsharp-windows-phone-7-visual-studio-2012"/>
    <updated>2013-02-24T00:00:00+00:00</updated>
    <id>http://blog.codebeside.org/blog/2013/02/24/fsharp-windows-phone-7-visual-studio-2012</id>
    <content type="html"><![CDATA[<p>F# 2.0 supported Silverlight 4, Silverlight 5, and Windows Phone 7.1, as several versions of FSharp.Core.dll were
shipped as part of the standalone F# redistribution. There were even some nice <a href="http://blogs.msdn.com/b/dsyme/archive/2010/08/20/f-windows-phone-7-silverlight-templates-now-on-visual-studio-gallery.aspx">Visual Studio 2010 templates</a> made by <a href="http://bloggemdano.blogspot.co.uk/">Daniel Mohl</a>.</p>

<p>In F# 3.0 there is no standalone redistributable package anymore, and Visual Studio 2012 only ships with two versions of FSharp.Core.dll: the full .NET 4.5 version, and a portable class library version targeting Profile47 (which includes .NET 4.5, Silverlight 5.0, and .NET for Windows Store apps).</p>

<p>I tried to create versions for Windows Phone 7 and for Profile88 (which additionally includes .NET 4.0, Silverlight 4.0, and Windows Phone 7.1) from the <a href="https://github.com/fsharp/fsharp">source code</a>, and I even got them to <a href="https://github.com/fsharp/fsharp/pull/102">compile</a>, but unfortunately I still get a bunch of Invalid Program exceptions at runtime when running on the emulator or on the device for both versions.</p>

<p>So I tried another approach - to reuse the FSharp.Core.dll version from F# 2.0 - and it seems to work just fine. Type providers and other new F# 3.0 features that depend on the library won't work, but at least we can use Visual Studio 2012 and some of the features like the triple quotes.</p>

<!-- more -->


<p>To make this work we must force the F# compiler to compile for Silverlight 4, which is no longer supported, so we need to modify the file <code>C:\Program Files (x86)\Microsoft SDKs\F#\3.0\Framework\v4.0\Microsoft.FSharp.targets</code> and comment out the following lines:</p>

<p>{% codeblock lang:xml %}
&lt;Error</p>

<pre><code>Condition="'$(SilverlightVersion)' != '' and '$(SilverlightVersion)' != 'v5.0'"
Text="In this version of Visual Studio, F# for Silverlight can only target Silverlight v5.0. Use a prior version of Visual Studio to target previous versions of Silverlight with F#."
</code></pre>

<p>/>
{% endcodeblock %}</p>

<p>Then if you take Daniel Mohl's template, change the manifest to state it supports Visual Studio 2012, and upgrade the .csproj and .fsproj files, it all works. I've uploaded the updated template to the <a href="http://visualstudiogallery.msdn.microsoft.com/241d3a0a-a0a7-42f5-badf-bbbed30514c8">Visual Studio Gallery</a>.</p>

<p>Here's a small sample of loading some data asynchronously and databinding to a record:</p>

<p>{% codeblock F# Code lang:fsharp %}</p>

<p>type Topic =</p>

<pre><code>{ Id : int
  Name : string
  Icon : string }
</code></pre>

<p>let PopulateTopics (addTopic : Action<Topic>) (onFinish : Action) =</p>

<pre><code>let synchronizationContext = SynchronizationContext.Current

let doInUiThred f = 
    synchronizationContext.Post ((fun _ -&gt; f()), null)

async {
    let! topics = (...)
    for topic in topics do
        doInUiThred (fun () -&gt; addTopic.Invoke topic)
    doInUiThred (fun () -&gt; onFinish.Invoke())
} |&gt; Async.Catch |&gt; Async.Ignore |&gt; Async.Start
</code></pre>

<p>{% endcodeblock %}</p>

<p>{% codeblock XAML code lang:xml %}</p>

<p><Grid></p>

<pre><code>&lt;ScrollViewer&gt;
    &lt;ItemsControl x:Name="topicsList"&gt;
        &lt;ItemsControl.ItemTemplate&gt;
            &lt;DataTemplate&gt;
                &lt;Button Click="OnTopicButtonClick"&gt;
                    &lt;Grid&gt;
                        &lt;Image Source="{Binding Icon}" /&gt;
                        &lt;TextBlock Foreground="Black"
                                   FontWeight="Bold"
                                   FontSize="40"
                                   TextWrapping="Wrap"
                                   Text="{Binding Name}" /&gt;
                    &lt;/Grid&gt;
                &lt;/Button&gt;
            &lt;/DataTemplate&gt;
        &lt;/ItemsControl.ItemTemplate&gt;
    &lt;/ItemsControl&gt;
&lt;/ScrollViewer&gt;
&lt;TextBlock Margin="0,0,0,200" 
           HorizontalAlignment="Center" 
           VerticalAlignment="Center" 
           Text="Loading..." 
           Visibility="Collapsed" 
           x:Name="loading" /&gt;
</code></pre>

<p></Grid></p>

<p>{% endcodeblock %}</p>

<p>{% codeblock C# Code lang:csharp %}</p>

<p>private void OnLoaded(object sender, RoutedEventArgs e)
{</p>

<pre><code>loading.Visibility = Visibility.Visible;

var topics = new ObservableCollection&lt;Topic&gt;();
topicsList.ItemsSource = topics;

PopulateTopics(
    topic =&gt; topics.Add(topic),
    () =&gt; loading.Visibility = Visibility.Collapsed);
</code></pre>

<p>}</p>

<p>private void OnTopicButtonClick(object sender, RoutedEventArgs e)
{</p>

<pre><code>var topic = (Topic)((Button)sender).DataContext;
NavigationService.Navigate(new Uri("/TopicPage.xaml?id=" + topic.Id, UriKind.Relative));
</code></pre>

<p>}
{% endcodeblock %}</p>
]]></content>
  </entry>
  
</feed>
