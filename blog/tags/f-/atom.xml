<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tag: F# | Code Beside]]></title>
  <link href="http://blog.codebeside.org/blog/tags/f-/atom.xml" rel="self"/>
  <link href="http://blog.codebeside.org/"/>
  <updated>2013-10-26T17:26:13+01:00</updated>
  <id>http://blog.codebeside.org/</id>
  <author>
    <name><![CDATA[Gustavo Guerra]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[F# for Screen Scraping]]></title>
    <link href="http://blog.codebeside.org/blog/2013/10/14/fsharp-for-screen-scraping"/>
    <updated>2013-10-14T23:58:00+01:00</updated>
    <id>http://blog.codebeside.org/blog/2013/10/14/fsharp-for-screen-scraping</id>
    <content type="html"><![CDATA[<p>One of the many things F# is great for is screen scraping. Here's why:</p>

<ul>
<li>Downloading multiple pages asynchronously and in parallel is trivial with F#'s async support</li>
<li>Navigating the HTML DOM is a great fit for higher order data processing combined with partial application</li>
<li>F# Interactive really shines in iterative processes like this, where you try something out, see it didn't work quite well, and keep adjusting until you get it right. Doing a full compile-run cycle on each iteration instead of simply evaluating in the REPL would make this task take much longer</li>
</ul>


<p><a href="http://htmlagilitypack.codeplex.com/">Html Agility Pack</a> is the obvious candidate to use for screen scraping in .NET, but like other LINQ-like libraries that rely heavily on extension methods, its API isn't ideal for use in F#. A simple wrapper will take care of that problem:</p>

<!-- More -->


<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>An F# wrapper for HtmlAgilityPack - HtmlAgilityPack.FSharp.fs </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">module</span> <span class="nn">HtmlAgilityPack</span><span class="p">.</span><span class="nc">FSharp</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">open</span> <span class="nc">HtmlAgilityPack</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">type</span> <span class="nc">HtmlNode</span> <span class="k">with</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">member</span> <span class="n">x</span><span class="o">.</span><span class="nc">FollowingSibling</span> <span class="n">name</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">sibling</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="nc">NextSibling</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">sibling</span> <span class="o">=</span> <span class="k">null</span> <span class="k">then</span>
</span><span class='line'>        <span class="k">null</span>
</span><span class='line'>    <span class="k">elif</span> <span class="n">sibling</span><span class="o">.</span><span class="nc">Name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">then</span>
</span><span class='line'>        <span class="n">sibling</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>        <span class="n">sibling</span><span class="o">.</span><span class="nc">FollowingSibling</span> <span class="n">name</span>
</span><span class='line'>
</span><span class='line'><span class="k">member</span> <span class="n">x</span><span class="o">.</span><span class="nc">FollowingSiblings</span> <span class="n">name</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">sibling</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="nc">NextSibling</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">sibling</span> <span class="o">&amp;</span><span class="n">lt</span><span class="o">;&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="k">null</span> <span class="k">then</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">sibling</span><span class="o">.</span><span class="nc">Name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">then</span>
</span><span class='line'>            <span class="k">yield</span> <span class="n">sibling</span>
</span><span class='line'>        <span class="k">yield</span><span class="o">!</span> <span class="n">sibling</span><span class="o">.</span><span class="nc">FollowingSiblings</span> <span class="n">name</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">member</span> <span class="n">x</span><span class="o">.</span><span class="nc">PrecedingSibling</span> <span class="n">name</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">sibling</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="nc">PreviousSibling</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">sibling</span> <span class="o">=</span> <span class="k">null</span> <span class="k">then</span>
</span><span class='line'>        <span class="k">null</span>
</span><span class='line'>    <span class="k">elif</span> <span class="n">sibling</span><span class="o">.</span><span class="nc">Name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">then</span>
</span><span class='line'>        <span class="n">sibling</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>        <span class="n">sibling</span><span class="o">.</span><span class="nc">PrecedingSibling</span> <span class="n">name</span>
</span><span class='line'>
</span><span class='line'><span class="k">member</span> <span class="n">x</span><span class="o">.</span><span class="nc">PrecedingSiblings</span> <span class="n">name</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">sibling</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="nc">PreviousSibling</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">sibling</span> <span class="o">&amp;</span><span class="n">lt</span><span class="o">;&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="k">null</span> <span class="k">then</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">sibling</span><span class="o">.</span><span class="nc">Name</span> <span class="o">=</span> <span class="n">name</span> <span class="k">then</span>
</span><span class='line'>            <span class="k">yield</span> <span class="n">sibling</span>
</span><span class='line'>        <span class="k">yield</span><span class="o">!</span> <span class="n">sibling</span><span class="o">.</span><span class="nc">PrecedingSiblings</span> <span class="n">name</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">parent</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">ParentNode</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">element</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">Element</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">elements</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">Elements</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">descendants</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">Descendants</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">descendantsAndSelf</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">DescendantsAndSelf</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">ancestors</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">Ancestors</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">ancestorsAndSelf</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">AncestorsAndSelf</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">followingSibling</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">FollowingSibling</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">followingSiblings</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">FollowingSiblings</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">precedingSibling</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">PrecedingSibling</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">precedingSiblings</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">PrecedingSiblings</span> <span class="n">name</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="k">inline</span> <span class="n">innerText</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">InnerText</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="k">inline</span> <span class="n">attr</span> <span class="n">name</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">GetAttributeValue</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="s2">&quot;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="k">inline</span> <span class="o">(?)</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="n">name</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">attr</span> <span class="n">name</span> <span class="n">node</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="k">inline</span> <span class="n">hasAttr</span> <span class="n">name</span> <span class="n">value</span> <span class="n">node</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">attr</span> <span class="n">name</span> <span class="n">node</span> <span class="o">=</span> <span class="n">value</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="k">inline</span> <span class="n">hasId</span> <span class="n">value</span> <span class="n">node</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">hasAttr</span> <span class="s2">&quot;id&quot;</span> <span class="n">value</span> <span class="n">node</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="k">inline</span> <span class="n">hasClass</span> <span class="n">value</span> <span class="n">node</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">hasAttr</span> <span class="s2">&quot;class&quot;</span> <span class="n">value</span> <span class="n">node</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="k">inline</span> <span class="n">hasText</span> <span class="n">value</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">HtmlNode</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">node</span><span class="o">.</span><span class="nc">InnerText</span> <span class="o">=</span> <span class="n">value</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">createDoc</span> <span class="n">html</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HtmlDocument</span><span class="bp">()</span>
</span><span class='line'><span class="n">doc</span><span class="o">.</span><span class="nc">LoadHtml</span> <span class="n">html</span>
</span><span class='line'><span class="n">doc</span><span class="o">.</span><span class="nc">DocumentNode</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>When we leave the "target" of an operation as the last parameter of a function, we can leverage partial application to remove the need to create anonymous lambdas when using higher order functions such as the ones needed for DOM traversing.</p>

<p>In this case, by taking the <code>this</code> parameter of the C# methods and putting it as the last parameter of our wrapper functions <code>elements</code>, <code>descendants</code>, <code>innerText</code>, etc., our code is now much easier to read and to understand than if we used the Html Agility Pack methods directly.</p>

<p>As an example, here is a small script that I used when developing one of my Windows Phone apps to get the list if all the rail stations in Ireland together with their coordinates:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>IrelandRailStations.fsx </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">r</span> <span class="s2">&quot;System.Net&quot;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">r</span> <span class="s2">&quot;../lib/portable/FSharp.Data.dll&quot;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">r</span> <span class="s2">&quot;../packages/HtmlAgilityPack-PCL.1.4.6/lib/HtmlAgilityPack-PCL.dll&quot;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">load</span> <span class="s2">&quot;HtmlAgilityPack.FSharp.fs&quot;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// get a page that lists the stations that start with firstLetter</span>
</span><span class='line'><span class="k">let</span> <span class="n">getStationListPage</span> <span class="n">firstLetter</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="s2">&quot;http://www.irishrail.ie/cat_stations_list.jsp?letter=&quot;</span> <span class="o">+</span> <span class="o">(</span><span class="kt">string</span> <span class="n">firstLetter</span><span class="o">)</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Http</span><span class="p">.</span><span class="nc">AsyncRequestString</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// get all the links to stations inside the &lt;ul class=&quot;results&quot;&gt;</span>
</span><span class='line'><span class="k">let</span> <span class="n">getStations</span> <span class="n">stationListPage</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">stationListPage</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">createDoc</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">descendants</span> <span class="s2">&quot;ul&quot;</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="n">hasClass</span> <span class="s2">&quot;results&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">head</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">descendants</span> <span class="s2">&quot;a&quot;</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="n">attr</span> <span class="s2">&quot;href&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">toArray</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// get the page for a station</span>
</span><span class='line'><span class="k">let</span> <span class="n">getStationPage</span> <span class="n">station</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="s2">&quot;http://www.irishrail.ie/&quot;</span> <span class="o">+</span> <span class="n">station</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Http</span><span class="p">.</span><span class="nc">AsyncRequestString</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">// get the latitude and longitude of a station from the google maps link in the station page</span>
</span><span class='line'><span class="k">let</span> <span class="n">getCoordinates</span> <span class="n">stationPage</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">googleMapsLink</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">stationPage</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">createDoc</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">descendants</span> <span class="s2">&quot;div&quot;</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="n">hasId</span> <span class="s2">&quot;map-ordnance&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">head</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">followingSibling</span> <span class="s2">&quot;ul&quot;</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">descendants</span> <span class="s2">&quot;a&quot;</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">head</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">attr</span> <span class="s2">&quot;href&quot;</span>
</span><span class='line'><span class="k">let</span> <span class="n">split</span> <span class="o">(</span><span class="n">c</span><span class="o">:</span><span class="kt">char</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span><span class="o">:</span><span class="kt">string</span><span class="o">)</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="nc">Split</span> <span class="n">c</span>
</span><span class='line'><span class="k">let</span> <span class="o">[|</span> <span class="s2">&quot;ll&quot;</span> <span class="o">;</span> <span class="n">coords</span> <span class="o">|]</span> <span class="o">=</span>
</span><span class='line'>    <span class="nc">Uri</span><span class="o">(</span><span class="n">googleMapsLink</span><span class="o">).</span><span class="nc">Query</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">split</span> <span class="k">&#39;</span><span class="o">&amp;</span><span class="n">amp</span><span class="o">;</span><span class="k">&#39;</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="n">split</span> <span class="sc">&#39;=&#39;</span><span class="o">)</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="nn">Seq</span><span class="p">.</span><span class="n">head</span> <span class="o">&amp;</span><span class="n">gt</span><span class="o">;&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="o">(=)</span> <span class="s2">&quot;ll&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">head</span>
</span><span class='line'><span class="k">let</span> <span class="o">[|</span> <span class="n">lat</span><span class="o">;</span> <span class="n">long</span> <span class="o">|]</span> <span class="o">=</span> <span class="n">coords</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">split</span> <span class="sc">&#39;,&#39;</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Array</span><span class="p">.</span><span class="n">map</span> <span class="kt">float</span>
</span><span class='line'><span class="n">lat</span><span class="o">,</span> <span class="n">long</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">stationsAndCoords</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">stations</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">[</span><span class="sc">&#39;A&#39;</span><span class="o">..</span><span class="sc">&#39;Z&#39;</span><span class="o">]</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">getStationListPage</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">RunSynchronously</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Array</span><span class="p">.</span><span class="n">collect</span> <span class="n">getStations</span>
</span><span class='line'><span class="k">let</span> <span class="n">lat</span><span class="o">,</span> <span class="n">long</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">stations</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">getStationPage</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">RunSynchronously</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Array</span><span class="p">.</span><span class="n">map</span> <span class="n">getCoordinates</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Array</span><span class="p">.</span><span class="n">unzip</span>
</span><span class='line'><span class="k">let</span> <span class="n">stations</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">stations</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Array</span><span class="p">.</span><span class="n">map</span> <span class="nn">Uri</span><span class="p">.</span><span class="nc">UnescapeDataString</span>
</span><span class='line'><span class="nn">Array</span><span class="p">.</span><span class="n">zip3</span> <span class="n">stations</span> <span class="n">lat</span> <span class="n">long</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Output:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">val</span> <span class="n">stationsAndCoords</span> <span class="o">:</span> <span class="o">(</span><span class="kt">string</span> <span class="o">*</span> <span class="kt">float</span> <span class="o">*</span> <span class="kt">float</span><span class="o">)</span> <span class="bp">[]</span> <span class="o">=</span>
</span><span class='line'>  <span class="o">[|(</span><span class="s2">&quot;Adamstown&quot;</span><span class="o">,</span> <span class="mi">53</span><span class="o">.</span><span class="mi">335285</span><span class="o">,</span> <span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">4523325</span><span class="o">);</span> <span class="o">(</span><span class="s2">&quot;Ardrahan&quot;</span><span class="o">,</span> <span class="mi">53</span><span class="o">.</span><span class="mi">157177</span><span class="o">,</span> <span class="o">-</span><span class="mi">8</span><span class="o">.</span><span class="mi">814831</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;(</span><span class="s2">&quot;Arklow&quot;</span><span class="o">,</span> <span class="mi">52</span><span class="o">.</span><span class="mi">793163</span><span class="o">,</span> <span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">159939</span><span class="o">);</span> <span class="o">(</span><span class="s2">&quot;Ashtown&quot;</span><span class="o">,</span> <span class="mi">53</span><span class="o">.</span><span class="mi">37552</span><span class="o">,</span> <span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">3313503</span><span class="o">);</span>
</span><span class='line'><span class="o">(</span><span class="s2">&quot;Athenry&quot;</span><span class="o">,</span> <span class="mi">53</span><span class="o">.</span><span class="mi">30153</span><span class="o">,</span> <span class="o">-</span><span class="mi">8</span><span class="o">.</span><span class="mi">748547</span><span class="o">);</span> <span class="o">(</span><span class="s2">&quot;Athlone&quot;</span><span class="o">,</span> <span class="mi">53</span><span class="o">.</span><span class="mi">427322</span><span class="o">,</span> <span class="o">-</span><span class="mi">7</span><span class="o">.</span><span class="mi">9368286</span><span class="o">);</span>
</span><span class='line'><span class="o">(</span><span class="s2">&quot;Athy&quot;</span><span class="o">,</span> <span class="mi">52</span><span class="o">.</span><span class="mi">991997</span><span class="o">,</span> <span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">976196</span><span class="o">);</span> <span class="o">(</span><span class="s2">&quot;Attymon&quot;</span><span class="o">,</span> <span class="mi">53</span><span class="o">.</span><span class="mi">321205</span><span class="o">,</span> <span class="o">-</span><span class="mi">8</span><span class="o">.</span><span class="mi">606078</span><span class="o">);</span>
</span><span class='line'><span class="o">...|]</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>You can also see that the same pattern was used for making the <code>String.Split</code> function play well with partial application.</p>

<p>Another neat feature of F# for scripting (I wouldn't recommend incorporating it in production code), is the ability to de-structure arrays in one liners, as done in <code>let [| "ll" ; coords |] =</code> and <code>let [| lat; long |] =</code>. The compiler will emit a warning saying that the match is not exhaustive, telling us that this might backfire if there are less than two elements in the array, but for the purpose of a one shot script to download some data it's fine.</p>

<p>And to give a second example, here's a snippet from my Learn On The Go app that processes the html of the lecture videos page of a Coursera course:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">lectureSections</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">trimAndUnescape</span> <span class="o">(</span><span class="n">text</span><span class="o">:</span><span class="kt">string</span><span class="o">)</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="nc">Replace</span><span class="o">(</span><span class="s2">&quot;&amp;amp;nbsp;&quot;</span><span class="o">,</span> <span class="s2">&quot;&quot;</span><span class="o">).</span><span class="nc">Trim</span><span class="bp">()</span><span class="o">.</span><span class="nc">Replace</span><span class="o">(</span><span class="s2">&quot;&amp;amp;amp;&quot;</span><span class="o">,</span> <span class="s2">&quot;&amp;amp;&quot;</span><span class="o">).</span><span class="nc">Replace</span><span class="o">(</span><span class="s2">&quot;&amp;amp;quot;&quot;</span><span class="o">,</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">).</span><span class="nc">Replace</span><span class="o">(</span><span class="s2">&quot;apos;&quot;</span><span class="o">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="o">).</span><span class="nc">Replace</span><span class="o">(</span><span class="s2">&quot;&amp;amp;lt;&quot;</span><span class="o">,</span> <span class="s2">&quot;&amp;lt;&quot;</span><span class="o">).</span><span class="nc">Replace</span><span class="o">(</span><span class="s2">&quot;&amp;amp;gt;&quot;</span><span class="o">,</span> <span class="s2">&quot;&amp;gt;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">endsWith</span> <span class="n">suffix</span> <span class="o">(</span><span class="n">text</span><span class="o">:</span><span class="kt">string</span><span class="o">)</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="nc">EndsWith</span> <span class="n">suffix</span>
</span><span class='line'><span class="n">createDoc</span> <span class="n">lecturesHtmlStr</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">descendants</span> <span class="s2">&quot;h3&quot;</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">h3</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">title</span> <span class="o">=</span> <span class="n">h3</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">innerText</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">trimAndUnescape</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">completed</span> <span class="o">=</span> <span class="n">h3</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">parent</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">hasClass</span> <span class="s2">&quot;course-item-list-header contracted&quot;</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">ul</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">h3</span>
</span><span class='line'>        <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">parent</span>
</span><span class='line'>        <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">followingSibling</span> <span class="s2">&quot;ul&quot;</span>
</span><span class='line'>    <span class="n">ul</span><span class="o">,</span> <span class="n">title</span><span class="o">,</span> <span class="n">completed</span><span class="o">)</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">ul</span><span class="o">,</span> <span class="o">_,</span> <span class="o">_)</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">ul</span> <span class="o">&amp;</span><span class="n">lt</span><span class="o">;&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="k">null</span><span class="o">)</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">ul</span><span class="o">,</span> <span class="n">title</span><span class="o">,</span> <span class="n">completed</span><span class="o">)</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">lectures</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">ul</span>
</span><span class='line'>        <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">elements</span> <span class="s2">&quot;li&quot;</span>
</span><span class='line'>        <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="n">element</span> <span class="s2">&quot;a&quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">a</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">id</span> <span class="o">=</span> <span class="n">a</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">attr</span> <span class="s2">&quot;data-lecture-id&quot;</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="kt">int</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">title</span> <span class="o">=</span> <span class="n">innerText</span> <span class="n">a</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">trimAndUnescape</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">quizAttemptedSpan</span> <span class="o">=</span> <span class="n">a</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">elements</span> <span class="s2">&quot;span&quot;</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">tryFind</span> <span class="o">(</span><span class="n">hasClass</span> <span class="s2">&quot;label label-success&quot;</span><span class="o">)</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">title</span><span class="o">,</span> <span class="n">quizAttempted</span> <span class="o">=</span>
</span><span class='line'>                <span class="k">match</span> <span class="n">quizAttemptedSpan</span> <span class="k">with</span>
</span><span class='line'>                <span class="o">|</span> <span class="nc">Some</span> <span class="n">span</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span>
</span><span class='line'>                    <span class="n">title</span><span class="o">.</span><span class="nc">Replace</span><span class="o">(</span><span class="n">trimAndUnescape</span> <span class="n">span</span><span class="o">.</span><span class="nc">InnerText</span><span class="o">,</span> <span class="s2">&quot;&quot;</span><span class="o">).</span><span class="nc">Trim</span><span class="bp">()</span><span class="o">,</span> <span class="bp">true</span>
</span><span class='line'>                <span class="o">|</span> <span class="nc">None</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">title</span><span class="o">,</span> <span class="bp">false</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">videoUrl</span> <span class="o">=</span> <span class="n">a</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">attr</span> <span class="s2">&quot;data-modal-iframe&quot;</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">lectureNotesUrl</span> <span class="o">=</span>
</span><span class='line'>                <span class="k">let</span> <span class="n">urls</span> <span class="o">=</span> <span class="n">a</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">followingSibling</span> <span class="s2">&quot;div&quot;</span>
</span><span class='line'>                             <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">elements</span> <span class="s2">&quot;a&quot;</span>
</span><span class='line'>                             <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="n">attr</span> <span class="s2">&quot;href&quot;</span><span class="o">)</span>
</span><span class='line'>                <span class="k">match</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">tryFind</span> <span class="o">(</span><span class="n">endsWith</span> <span class="s2">&quot;.pdf&quot;</span><span class="o">)</span> <span class="n">urls</span> <span class="k">with</span>
</span><span class='line'>                <span class="o">|</span> <span class="nc">Some</span> <span class="n">url</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">url</span>
</span><span class='line'>                <span class="o">|</span> <span class="o">_</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>            <span class="k">let</span> <span class="n">viewed</span> <span class="o">=</span> <span class="n">a</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">parent</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">hasClass</span> <span class="s2">&quot;viewed&quot;</span>
</span><span class='line'>            <span class="o">{</span> <span class="nc">Id</span> <span class="o">=</span> <span class="n">id</span>
</span><span class='line'>              <span class="nc">Title</span> <span class="o">=</span> <span class="n">title</span>
</span><span class='line'>              <span class="nc">VideoUrl</span> <span class="o">=</span> <span class="n">videoUrl</span>
</span><span class='line'>              <span class="nc">LectureNotesUrl</span> <span class="o">=</span> <span class="n">lectureNotesUrl</span>
</span><span class='line'>              <span class="nc">Viewed</span> <span class="o">=</span> <span class="n">viewed</span>
</span><span class='line'>              <span class="nc">QuizAttempted</span> <span class="o">=</span> <span class="n">quizAttempted</span> <span class="o">})</span>
</span><span class='line'>        <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">toArray</span>
</span><span class='line'>    <span class="o">{</span> <span class="nc">Title</span> <span class="o">=</span> <span class="n">title</span>
</span><span class='line'>      <span class="nc">Completed</span> <span class="o">=</span> <span class="n">completed</span>
</span><span class='line'>      <span class="nc">Lectures</span> <span class="o">=</span> <span class="n">lectures</span> <span class="o">})</span>
</span><span class='line'><span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">toArray</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FSharp.Data 1.1.9 released]]></title>
    <link href="http://blog.codebeside.org/blog/2013/07/21/fsharp-data-1-1-9-released"/>
    <updated>2013-07-21T22:14:00+01:00</updated>
    <id>http://blog.codebeside.org/blog/2013/07/21/fsharp-data-1-1-9-released</id>
    <content type="html"><![CDATA[<p>We've just released version <a href="http://www.nuget.org/packages/FSharp.Data/1.1.9">1.1.9</a> of <a href="http://fsharp.github.io/FSharp.Data/">FSharp.Data</a>, and I realized we've not been announcing new releases since version 1.1.1 when Tomas <a href="http://tomasp.net/blog/fsharp-data.aspx">first announced it</a>, so I though I'd rectify that. In addition to bug fixes, here what's has been added to FSharp.Data since then:</p>

<ul>
<li>The behaviour of CsvProvider can be fine tuned by using the HasHeaders, Schema, IgnoreErrors, SafeMode, and PreferOptionals parameters. See the CsvProvider documentation <a href="http://fsharp.github.io/FSharp.Data/library/CsvProvider.html">here</a>.</li>
<li>The CSV Parser and Reader can now be used standalone. See the CsvFile documentation <a href="http://fsharp.github.io/FSharp.Data/library/CsvFile.html">here</a>.</li>
<li>Guid types are now supported in CsvProvider, JsonProvider, and XmlProvider.</li>
<li>Support to disable caching for CSV files too big to fit in memory.</li>
<li>Support for cookies, binary files and client certificates in FSharp.Net.Http.</li>
<li>Save, Filter, Take, TakeWhile, Skip, SkipWhile, and Truncate operations for CsvProvider and CsvFile.</li>
<li>Support for Windows Phone 7.</li>
</ul>


<p>There's still a lot of room for improvement, and we love pull requests, so please contribute, even if it's only fixing a typo in the docs. A getting started guide is available <a href="http://fsharp.github.io/FSharp.Data/contributing.html">here</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Building Type Providers - Part 1]]></title>
    <link href="http://blog.codebeside.org/blog/2013/05/13/building-type-providers-part1"/>
    <updated>2013-05-13T00:17:00+01:00</updated>
    <id>http://blog.codebeside.org/blog/2013/05/13/building-type-providers-part1</id>
    <content type="html"><![CDATA[<p>Type Providers are the biggest new feature of F# 3.0. They allow us to leverage the power of the static type system in areas that have typically been the territory of dynamic languages and stringly typing. A picture is worth a thousand words, so here's 12 pictures that show type providers in action:</p>

<blockquote><p><a href="http://blogs.msdn.com/b/dsyme/archive/2013/01/30/twelve-type-providers-in-pictures.aspx">All your types are belong to us</a></p></blockquote>

<p>There are already several good samples and articles about using type providers, but there still isn't a lot about creating type providers. Having worked recently on <a href="http://fsharp.github.com/FSharp.Data/">FSharp.Data</a> I decided to share some tips about building type providers.</p>

<!-- More -->


<h2>Getting Started</h2>

<p>The basic steps to creating a type provider are:</p>

<ul>
<li><p>Get the <code>ProvidedTypes.fs</code> and <code>ProvidedTypes.fsi</code> files from the <a href="http://fsharp3sample.codeplex.com/">F# 3.0 Sample Pack</a> and add it to your project.</p></li>
<li><p>Follow the instructions in <a href="http://msdn.microsoft.com/en-gb/library/hh361034.aspx">Tutorial: Creating a Type Provider</a> to create instances of <code>ProvidedTypeDefinition</code>, <code>ProvidedProperty</code>, <code>ProvidedMethod</code>, etc. in order to to define the API you want.</p></li>
</ul>


<p>After you've read that tutorial, let's carry on...</p>

<h2>Hiding the underlying representation</h2>

<p>In the simplest of cases, there's no underlying representation, so you just set the base class of your provided types to <code>obj</code>. You'll create some expressions by wrapping code in <code>&lt;@@ ... @@&gt;</code> to create quotations, and assign them to the <code>InvokeCode</code> and <code>GetterCode</code> properties of your provided methods and properties, completely ignoring the <code>this</code> argument that is passed to them. After compilation, there will be no mention whatsoever of your provided types, they will have been all erased, and the only thing left is that code you defined inside the quotations. Effectively, the type providers are only giving you syntactic sugar and IntelliSense over things you could already accomplish without using them.</p>

<p>However, in most cases, there will be some underlying data representation, and you will probably want to create some types to hold that data. A big part of the logic will be in these types, and you'll specify them as the base classes of your provided types. In this case, the F# compiler will copy and embed those base types in the assembly that is consuming the type provider. This means that in addition to the syntactic sugar, the assembly that's referencing the type providers will also have some more additional code.</p>

<p>As expected, all the members of the base types will appear on the IntelliSense of the provided types. In some situations, that's a good thing, and exactly what you wanted. On other cases (and I would guess most of the time), you intended those members to be just internal code to be used inside the implementation of the provided methods and properties, and you don't want them to show up, as after all Type Providers are mostly about providing a nice API to its users. You can see this effect on the current version of the <a href="http://www.tryfsharp.org/Learn/data-science#world-bank-type-provider">World Bank type provider on TryF#</a>. If you press the dot after <code>data</code>, you'll see that in addition to <code>Countries</code> and <code>Regions</code>, the IntelliSense pop-up will also include <code>_GetCountries</code>, <code>_GetRegions</code> and other members that aren't intended for direct use. The ideal would be for them not to show up. How can we do that?</p>

<ul>
<li>If you came from an OO background, the first thing you'd think would be to make those members protected, but there is no <code>protected</code> modifier in F#. Even if there was, you're not really creating a type and inheriting from the base type, it's all erased.</li>
<li>You can't also make those members <code>internal</code>, because your runtime representation types are always considered to belong to the type provider assembly, and not to the assembly that is using the type provider, even when the F# compiler copies those types over.</li>
<li>In C#, you can decorate methods and properties with <code>[System.ComponentModel.Browsable(false)]</code> to have them not show up on IntelliSense, but unfortunately that doesn't work in F#.</li>
<li>You can create an interface with those members, and make your runtime representation types implement that interface. That way, they won't show up on IntelliSense because F# always does explicit interface implementation. This won't work for static members though.</li>
<li>The constructors of the erased to types don't show up on the IntelliSense, so you can replace some static members like <code>Parse</code> and <code>Load</code> with constructors instead.</li>
<li>If you define a <code>ProvidedMethod</code> with the same parameter types of one of the methods of the runtime representation type, just with a different return type, that method will effectively be hidden, and you won't need to do anything to hide it.</li>
<li><code>ProvidedTypeDefinition</code> has a <code>HideObjectMethods</code> property that allows you to hide the <code>GetHashCode()</code>, <code>GetType()</code>, <code>ToString()</code> and <code>Equals</code> methods from IntelliSense, but if the base type overrides any of those methods, they will show up anyway. I still haven't found a workaround for this.</li>
</ul>


<p>The <a href="http://fsharp.github.com/FSharp.Data/">FSharp.Data</a> version of the World Bank type provider (and this also applies to the CSV, XML, JSON and Freebase type providers) uses interfaces and constructors to hide the unwanted members, so you don't see any <code>_Something</code> method.</p>

<h2>Splitting into two assemblies</h2>

<p>When the type provider starts to get bigger, you might want to separate the runtime and design-time components into two separate assemblies. You also need to do this when you want to support multiple .NET framework profiles (like Silverlight or Portable Class Libraries), where you can have a single design-time assembly, but a different runtime assembly for each profile.</p>

<p>In this scenario, the design-time assembly can't just reference the runtime assembly, because there are multiple versions of them. And even if you're not supporting multiple profiles, the design-time assemblies of type providers are loaded inside the F# compiler process, which makes any assembly dependency for the design-time component to not work correctly. To work around this, usually there's no dependency between the design-time assembly and the runtime assembly, and instead we include all the files of the runtime assembly directly in the design-time assembly. This may increase the size of the design-time component, but it's not a big deal because that dll doesn't need to be included in the final application.</p>

<p>But with this solution, comes a big problem: your quotations will stop working. Why? Because you're referencing the types of the wrong assembly. To overcome this, the <code>TypeProviderConfig</code> that is passed to your type provider has a <code>RuntimeAssembly</code> property which allows you to load the runtime component using <code>Assembly.LoadFrom</code>, get the types you need using <code>Assembly.GetType</code>, and construct your expressions manually from that. Most of the samples in the <a href="http://fsharp3sample.codeplex.com/">F# 3.0 Sample Pack</a> use this. Great, problem solved, right?</p>

<p>Back in January, I started adding support for portable class libraries in <a href="http://fsharp.github.com/FSharp.Data/">FSharp.Data</a> because I wanted to use it on some Windows Phone and Windows 8 apps. After changing a couple of places from quotations to manually creating expression and using the reflection API, I though to myself:</p>

<blockquote><p>"No! The code was nice and clean with type safe quotations, and now I'm turning it to this mess with error prone reflection calls using a stringly typed api. It's a huge step back. There has to be a better way."</p></blockquote>

<p>And eventually after a couple of failed attempts and a lot of discussion on the github issue, I finally arrived at a solution: process the quotations to fix the type references to the right assembly. This is done by <code>AssemblyReplacer</code>, which you can find <a href="https://github.com/fsharp/FSharp.Data/blob/master/src/Providers/AssemblyReplacer.fs">here</a>. It's pretty much independent of the rest of <a href="http://fsharp.github.com/FSharp.Data/">FSharp.Data</a>, so you can just copy it over to your type provider project if you need it.</p>

<p>There are places where even without splitting the type provider into a design-time and runtime assembly, it isn't possible to use quotations, and you still need to keep creating expressions manually. That only happens when you use generics parameterized by a type generated by the type provider. For those, cases <a href="http://tomasp.net/">Tomas</a> has created a nice dynamic operator (?) implementation in <code>QuotationBuilder</code> which is available <a href="https://github.com/fsharp/FSharp.Data/blob/master/src/Providers/QuotationBuilder.fs">here</a>.</p>

<h2>Coming Next</h2>

<ul>
<li>Debugging type providers</li>
<li>Supporting multiple .NET framework profiles</li>
<li>Common errors found during type provider development</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[F#, Windows Phone 7 & Visual Studio 2012]]></title>
    <link href="http://blog.codebeside.org/blog/2013/02/24/fsharp-windows-phone-7-visual-studio-2012"/>
    <updated>2013-02-24T00:00:00+00:00</updated>
    <id>http://blog.codebeside.org/blog/2013/02/24/fsharp-windows-phone-7-visual-studio-2012</id>
    <content type="html"><![CDATA[<p>F# 2.0 supported Silverlight 4, Silverlight 5, and Windows Phone 7.1, as several versions of FSharp.Core.dll were
shipped as part of the standalone F# redistribution. There were even some nice <a href="http://blogs.msdn.com/b/dsyme/archive/2010/08/20/f-windows-phone-7-silverlight-templates-now-on-visual-studio-gallery.aspx">Visual Studio 2010 templates</a> made by <a href="http://bloggemdano.blogspot.co.uk/">Daniel Mohl</a>.</p>

<p>In F# 3.0 there is no standalone redistributable package anymore, and Visual Studio 2012 only ships with two versions of FSharp.Core.dll: the full .NET 4.5 version, and a portable class library version targeting Profile47 (which includes .NET 4.5, Silverlight 5.0, and .NET for Windows Store apps).</p>

<p>I tried to create versions for Windows Phone 7 and for Profile88 (which additionally includes .NET 4.0, Silverlight 4.0, and Windows Phone 7.1) from the <a href="https://github.com/fsharp/fsharp">source code</a>, and I even got them to <a href="https://github.com/fsharp/fsharp/pull/102">compile</a>, but unfortunately I still get a bunch of Invalid Program exceptions at runtime when running on the emulator or on the device for both versions.</p>

<p>So I tried another approach - to reuse the FSharp.Core.dll version from F# 2.0 - and it seems to work just fine. Type providers and other new F# 3.0 features that depend on the library won't work, but at least we can use Visual Studio 2012 and some of the features like the triple quotes.</p>

<!-- more -->


<p>To make this work we must force the F# compiler to compile for Silverlight 4, which is no longer supported, so we need to modify the file <code>C:\Program Files (x86)\Microsoft SDKs\F#\3.0\Framework\v4.0\Microsoft.FSharp.targets</code> and comment out the following lines:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="ni">&amp;lt;</span>Error<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span>Condition=&quot;&#39;$(SilverlightVersion)&#39; != &#39;&#39; and &#39;$(SilverlightVersion)&#39; != &#39;v5.0&#39;&quot;
</span><span class='line'>Text=&quot;In this version of Visual Studio, F# for Silverlight can only target Silverlight v5.0. Use a prior version of Visual Studio to target previous versions of Silverlight with F#.&quot;
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>/&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Then if you take Daniel Mohl's template, change the manifest to state it supports Visual Studio 2012, and upgrade the .csproj and .fsproj files, it all works. I've uploaded the updated template to the <a href="http://visualstudiogallery.msdn.microsoft.com/241d3a0a-a0a7-42f5-badf-bbbed30514c8">Visual Studio Gallery</a>.</p>

<p>Here's a small sample of loading some data asynchronously and databinding to a record:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>F# Code  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">type</span> <span class="nc">Topic</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;{</span> <span class="nc">Id</span> <span class="o">:</span> <span class="kt">int</span>
</span><span class='line'>  <span class="nc">Name</span> <span class="o">:</span> <span class="kt">string</span>
</span><span class='line'>  <span class="nc">Icon</span> <span class="o">:</span> <span class="kt">string</span> <span class="o">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">let</span> <span class="nc">PopulateTopics</span> <span class="o">(</span><span class="n">addTopic</span> <span class="o">:</span> <span class="nc">Action</span><span class="o">&lt;</span><span class="nc">Topic</span><span class="o">&gt;)</span> <span class="o">(</span><span class="n">onFinish</span> <span class="o">:</span> <span class="nc">Action</span><span class="o">)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">let</span> <span class="n">synchronizationContext</span> <span class="o">=</span> <span class="nn">SynchronizationContext</span><span class="p">.</span><span class="nc">Current</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">doInUiThred</span> <span class="n">f</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">synchronizationContext</span><span class="o">.</span><span class="nc">Post</span> <span class="o">((</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">f</span><span class="bp">()</span><span class="o">),</span> <span class="k">null</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">async</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">let</span><span class="o">!</span> <span class="n">topics</span> <span class="o">=</span> <span class="o">(...)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">topic</span> <span class="k">in</span> <span class="n">topics</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">doInUiThred</span> <span class="o">(</span><span class="k">fun</span> <span class="bp">()</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">addTopic</span><span class="o">.</span><span class="nc">Invoke</span> <span class="n">topic</span><span class="o">)</span>
</span><span class='line'>    <span class="n">doInUiThred</span> <span class="o">(</span><span class="k">fun</span> <span class="bp">()</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">onFinish</span><span class="o">.</span><span class="nc">Invoke</span><span class="bp">()</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Catch</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Ignore</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Start</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>XAML code  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;Grid&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>ScrollViewer<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>ItemsControl x:Name=&quot;topicsList&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'>        <span class="ni">&amp;lt;</span>ItemsControl.ItemTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'>            <span class="ni">&amp;lt;</span>DataTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'>                <span class="ni">&amp;lt;</span>Button Click=&quot;OnTopicButtonClick&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'>                    <span class="ni">&amp;lt;</span>Grid<span class="ni">&amp;gt;</span>
</span><span class='line'>                        <span class="ni">&amp;lt;</span>Image Source=&quot;{Binding Icon}&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'>                        <span class="ni">&amp;lt;</span>TextBlock Foreground=&quot;Black&quot;
</span><span class='line'>                                   FontWeight=&quot;Bold&quot;
</span><span class='line'>                                   FontSize=&quot;40&quot;
</span><span class='line'>                                   TextWrapping=&quot;Wrap&quot;
</span><span class='line'>                                   Text=&quot;{Binding Name}&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'>                    <span class="ni">&amp;lt;</span>/Grid<span class="ni">&amp;gt;</span>
</span><span class='line'>                <span class="ni">&amp;lt;</span>/Button<span class="ni">&amp;gt;</span>
</span><span class='line'>            <span class="ni">&amp;lt;</span>/DataTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'>        <span class="ni">&amp;lt;</span>/ItemsControl.ItemTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>/ItemsControl<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/ScrollViewer<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>TextBlock Margin=&quot;0,0,0,200&quot;
</span><span class='line'>           HorizontalAlignment=&quot;Center&quot;
</span><span class='line'>           VerticalAlignment=&quot;Center&quot;
</span><span class='line'>           Text=&quot;Loading...&quot;
</span><span class='line'>           Visibility=&quot;Collapsed&quot;
</span><span class='line'>           x:Name=&quot;loading&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;/Grid&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>C# Code  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="p">&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">private</span> <span class="k">void</span> <span class="n">OnLoaded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="n">loading</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Visible</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">var</span> <span class="n">topics</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ObservableCollection</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Topic</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;();</span>
</span><span class='line'><span class="n">topicsList</span><span class="p">.</span><span class="n">ItemsSource</span> <span class="p">=</span> <span class="n">topics</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">PopulateTopics</span><span class="p">(</span>
</span><span class='line'>    <span class="n">topic</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">topics</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">topic</span><span class="p">),</span>
</span><span class='line'>    <span class="p">()</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">loading</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Collapsed</span><span class="p">);</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">private</span> <span class="k">void</span> <span class="n">OnTopicButtonClick</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="kt">var</span> <span class="n">topic</span> <span class="p">=</span> <span class="p">(</span><span class="n">Topic</span><span class="p">)((</span><span class="n">Button</span><span class="p">)</span><span class="n">sender</span><span class="p">).</span><span class="n">DataContext</span><span class="p">;</span>
</span><span class='line'><span class="n">NavigationService</span><span class="p">.</span><span class="n">Navigate</span><span class="p">(</span><span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="s">&quot;/TopicPage.xaml?id=&quot;</span> <span class="p">+</span> <span class="n">topic</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">UriKind</span><span class="p">.</span><span class="n">Relative</span><span class="p">));</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[F# as a Octave/Matlab replacement for Machine Learning]]></title>
    <link href="http://blog.codebeside.org/blog/2011/10/27/f-as-a-octavematlab-replacement-for-machine-learning"/>
    <updated>2011-10-27T00:00:00+01:00</updated>
    <id>http://blog.codebeside.org/blog/2011/10/27/f-as-a-octavematlab-replacement-for-machine-learning</id>
    <content type="html"><![CDATA[<p>
    <strong>EDIT</strong>: As another version of the ml-class course has started, I&#39;ve made the repository private</p>


<p>
    Back when I was in college, I took three different courses that dealt with subjects related to machine learning and data mining. Although I didn&rsquo;t lose interest on those matters, my work has led me in a totally unrelated direction, so I haven&rsquo;t exercised any of that knowledge in about eight years or so. A few weeks ago, I stumbled upon Stanford&rsquo;s online class on <a href="http://www.ml-class.org">Machine Learning</a> and decided to enroll. I want to revive many of the things I have forgotten and try to put them into practice, as nowadays it&rsquo;s very easy to access large amounts of interesting data from all kinds of online sources.</p>


<p>
    The programming exercises of this class are supposed to be done in Octave or Matlab, and while I understand the advantages of these tools, my past experience (where all the exercises and projects were done either with SAS or with Matlab) shows me that not using a general purpose programming languages doesn&rsquo;t help a lot in turning academic exercises into real world programs. As professor Andrew Ng said in the introduction, one of the goals of the class is for us to put machine learning into practice in real world problems we care about, so I decided that I&rsquo;ll implement all the algorithms and exercises in F#.</p>


<pre><code>&lt;!-- more --&gt;
</code></pre>

<p>
    I&rsquo;m using <a href="http://numerics.mathdotnet.com/">Math.NET Numerics</a> for the linear algebra and statistics, and while some operations are not as simple as in Octave, being able to use higher order functions instead of for loops compensates for it. As an example, look at the code for feature normalization in Octave:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='matlab'><span class='line'><span class="k">function</span><span class="w"> </span>[X_norm, mu, sigma] <span class="p">=</span><span class="w"> </span><span class="nf">featureNormalize</span><span class="p">(</span>X<span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">X_norm</span> <span class="p">=</span> <span class="n">X</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">mu</span> <span class="p">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
</span><span class='line'><span class="n">sigma</span> <span class="p">=</span> <span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">m</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> 1<span class="p">);</span>
</span><span class='line'><span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> 1<span class="p">:</span><span class="n">m</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">X_norm</span><span class="p">(</span><span class="nb">i</span><span class="p">,:)</span> <span class="p">=</span> <span class="p">(</span><span class="n">X</span><span class="p">(</span><span class="nb">i</span><span class="p">,:)</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">./</span> <span class="n">sigma</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">end</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>
    And here&rsquo;s the equivalent F# code:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">featureNormalize</span> <span class="o">(</span><span class="nc">X</span><span class="o">:</span> <span class="o">#</span><span class="nc">Matrix</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">let</span> <span class="err"></span> <span class="o">=</span>
</span><span class='line'>    <span class="nn">X</span><span class="p">.</span><span class="nc">ColumnEnumerator</span><span class="bp">()</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">col</span><span class="o">.</span><span class="nc">Mean</span><span class="bp">()</span><span class="o">)</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">DenseVector</span><span class="p">.</span><span class="n">ofSeq</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="err"></span> <span class="o">=</span>
</span><span class='line'>    <span class="nn">X</span><span class="p">.</span><span class="nc">ColumnEnumerator</span><span class="bp">()</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">col</span><span class="o">.</span><span class="nc">StandardDeviation</span><span class="bp">()</span><span class="o">)</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">DenseVector</span><span class="p">.</span><span class="n">ofSeq</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="nc">X</span> <span class="o">=</span>
</span><span class='line'>    <span class="nc">X</span> <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Matrix</span><span class="p">.</span><span class="n">mapRows</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="n">row</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="o">(</span><span class="n">row</span> <span class="o">-</span> <span class="err"></span><span class="o">)</span> <span class="o">./</span> <span class="err"></span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span><span class="nc">X</span><span class="o">,</span> <span class="err"></span><span class="o">,</span> <span class="err"></span><span class="o">)</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>
    Even though calculating the mean and standard deviation is a little more elaborate than using just a built-in function call, the actual normalization code is more straightforward, so we&rsquo;re not really loosing any productivity by using F#, considering that we have the same kind of development interactivity thanks to F# Interactive. Other nice touches in F# are the ability to use greek letters and the possibility of separating the data from the algorithm parameters by means of the pipelining operator (|&gt;). By leaving all the data parameters at the end and aggregating them into a tuple, we can turn this code:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="nn">LinearRegression</span><span class="p">.</span><span class="n">plotGradientDescentIterations</span> <span class="err"></span> <span class="n">num_iters</span> <span class="nc">XNorm</span> <span class="n">y</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>
    into this:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">(</span><span class="nc">XNorm</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">|&gt;</span> <span class="nn">LinearRegression</span><span class="p">.</span><span class="n">plotGradientDescentIterations</span> <span class="err"></span> <span class="n">num_iters</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>
    which I think is clearer.</p>


<p>
    I also like the fact that Math.NET Numerics has a separate type for vectors instead of using one-column or one-row matrices for that, allowing us not to worry about transposing the vectors when multiplying.</p>


<p>
    Mimicking Matlab charting capabilities was a bit more tricky. For the majority of charting I&rsquo;m using <a href="http://code.msdn.microsoft.com/FSharpChart-b59073f5">FSharpChart</a>, but the Microsoft Chart Controls that it wraps don&rsquo;t support contour nor surface plots. For contour plots I ended up using <a href="http://dynamicdatadisplay.codeplex.com/">WPF Dynamic Data Display</a>, and for surface plots I adapted a <a href="http://www.codeproject.com/KB/WPF/WPFChart3D.aspx">sample from CodeProject</a>. I&rsquo;m not really happy with the surface plot, as it&rsquo;s really very basic, so I&rsquo;ll definitely try to improve it in the future. Here&rsquo;s a sample of charts from Matlab:</p>


<p>
    <a href="http://blog.codebeside.org/images/image.png"><img alt="image" border="0" height="217" src="http://blog.codebeside.org/images/image_thumb.png" style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" width="244" /></a><a href="http://blog.codebeside.org/images/image_1.png"><img alt="image" border="0" height="217" src="http://blog.codebeside.org/images/image_thumb_1.png" style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" width="244" /></a><a href="http://blog.codebeside.org/images/image_2.png"><img alt="image" border="0" height="217" src="http://blog.codebeside.org/images/image_thumb_2.png" style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" width="244" /></a><a href="http://blog.codebeside.org/images/image_3.png"><img alt="image" border="0" height="217" src="http://blog.codebeside.org/images/image_thumb_3.png" style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" width="244" /></a></p>


<p>
    And here are the equivalent ones I was able to produce in F#:</p>


<p>
    <a href="http://blog.codebeside.org/images/image_4.png"><img alt="image" border="0" height="244" src="http://blog.codebeside.org/images/image_thumb_4.png" style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" width="244" /></a><a href="http://blog.codebeside.org/images/image_5.png"><img alt="image" border="0" height="244" src="http://blog.codebeside.org/images/image_thumb_5.png" style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" width="244" /></a><a href="http://blog.codebeside.org/images/image_6.png"><img alt="image" border="0" height="244" src="http://blog.codebeside.org/images/image_thumb_6.png" style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" width="244" /></a><a href="http://blog.codebeside.org/images/image_7.png"><img alt="image" border="0" height="244" src="http://blog.codebeside.org/images/image_thumb_7.png" style="background-image: none; border-right-width: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" width="244" /></a></p>


<p>
    I&rsquo;m putting this available at <a href="https://github.com/ovatsus/MLClass">https://github.com/ovatsus/MLClass</a>. I&rsquo;m only going to push the commits weekly after the class exercise deadlines expire, so at the time of this post only the implementation of the Linear Regression exercises is available.</p>


<p>
    So far this has been a very rewarding experience, as besides preparing the way so I can reuse this code in the future, I&#39;ve been submitting patches both to Math.NET Numerics and to FSharpChart.</p>


<p>
    <strong>Edit:</strong></p>


<p>
    As some people have pointed out in the comments, the Octave version of feature normalization could also be done without iteration:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='matlab'><span class='line'><span class="k">function</span><span class="w"> </span>[X_norm, mu, sigma] <span class="p">=</span><span class="w"> </span><span class="nf">featureNormalize</span><span class="p">(</span>X<span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">mu</span> <span class="p">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
</span><span class='line'><span class="n">sigma</span> <span class="p">=</span> <span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
</span><span class='line'><span class="n">m</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> 1<span class="p">);</span>
</span><span class='line'><span class="n">X_norm</span> <span class="p">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="nb">repmat</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> 1<span class="p">))</span> <span class="o">/</span> <span class="nb">diag</span><span class="p">(</span><span class="n">sigma</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>
    In this case the corresponding F# code would be:</p>


<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">featureNormalize</span> <span class="o">(</span><span class="nc">X</span><span class="o">:</span> <span class="nc">Matrix</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;)</span> <span class="o">=&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="k">let</span> <span class="err"></span> <span class="o">=</span>
</span><span class='line'>    <span class="nn">X</span><span class="p">.</span><span class="nc">ColumnEnumerator</span><span class="bp">()</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">col</span><span class="o">.</span><span class="nc">Mean</span><span class="bp">()</span><span class="o">)</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">DenseVector</span><span class="p">.</span><span class="n">ofSeq</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="err"></span> <span class="o">=</span>
</span><span class='line'>    <span class="nn">X</span><span class="p">.</span><span class="nc">ColumnEnumerator</span><span class="bp">()</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">j</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">col</span><span class="o">.</span><span class="nc">StandardDeviation</span><span class="bp">()</span><span class="o">)</span>
</span><span class='line'>    <span class="o">|&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="nn">DenseVector</span><span class="p">.</span><span class="n">ofSeq</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="err"></span><span class="nc">Expanded</span> <span class="o">=</span> <span class="nn">DenseMatrix</span><span class="p">.</span><span class="n">initRow</span> <span class="nn">X</span><span class="p">.</span><span class="nc">RowCount</span> <span class="nn">X</span><span class="p">.</span><span class="nc">ColumnCount</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="err"></span><span class="o">)</span>
</span><span class='line'><span class="k">let</span> <span class="err"></span><span class="nc">Diag</span> <span class="o">=</span> <span class="nn">DenseMatrix</span><span class="p">.</span><span class="n">diag</span> <span class="err"></span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="nc">X</span> <span class="o">=</span> <span class="o">(</span><span class="nc">X</span> <span class="o">-</span> <span class="err"></span><span class="nc">Expanded</span><span class="o">)</span> <span class="o">*</span> <span class="err"></span><span class="nn">Diag</span><span class="p">.</span><span class="nc">Inverse</span><span class="bp">()</span>
</span><span class='line'>
</span><span class='line'><span class="o">(</span><span class="nc">X</span><span class="o">,</span> <span class="err"></span><span class="o">,</span> <span class="err"></span><span class="o">)</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>
]]></content>
  </entry>
  
</feed>
